# 如何修改 node_modules 里的文件

由于前端开发的过程中所使用的npm依赖包，可能会有bug出现的情况，而官方可能无法快速的修改此bug。这个时候就需要开发团队对npm的依赖包的源码进行修改。由于重新安装依赖会覆盖之前的修改，所以直接修改`node_modules`的源码一般是不可取的。

为了应对此种情况，一般比较实际的应对方法有以下几种：
1. 下载别人代码到本地，放在 `src` 目录，修改后手动引入。
2. `fork` 别人的代码到自己仓库，修改后，从自己仓库安装这个插件。
3. 使用`patch-package`修改

这两个办法的缺陷就是：更新麻烦，我们每次都需要手动去更新代码，无法与插件同步更新。如果我们要修改的代码仅仅是别人的一个小模块，其他大部分代码都不动，这时候有一个很投机的操作：利用 webpack alias 来覆盖别人代码。


## webpack alias 的作用
<hr />
`webpack alias`一般用来配置路径别名，是我们可以少写路径代码：

```
chainWebpack: config => {
  config.resolve.alias
    .set('@', resolve('src'))
    .set('#', resolve('src/views/page1'))
    .set('&', resolve('src/views/page2'));
}
```


`webpack alias` 会替换我们写的“简写路径”，并且它对 `node_modules` 里面的文件也是生效的。这时候我们可以将别人源码里面引用模块的路径替换成我们自己的文件。

具体操作步骤如下：
1. 找到别人源码里面的需要修改的模块，复制代码到 src 目录
2. 修改其中的 bug，注意里面引用其他的文件都需要写成绝对路径
3. 找到这个模块被引入的路径（我们需要拦截的路径）
4. 配置 webpack alias

[相关链接](https://juejin.cn/post/6844904163558555662)

## patch-package
<hr />
步骤： 

1. 安装`patch-package`: `npm i patch-package --save-dev`；
2. 修改`package.json`，新增命令`postinstall`:
```
"scripts": {
  "postinstall": "patch-package"
}
```
3. 修改`node_modules`里面的代码
4. 执行命令`npx patch-package package_name`

当这个包版本更新后，执行命令：`git apply --ignore-whitespace patches/qiankun+2.0.11.patch` 即可。其中 `qiankun+2.0.11.patch` 是它生成的文件名。


