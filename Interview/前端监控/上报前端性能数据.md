# 上报前端性能数据 
<a src="https://github.com/forthealllight/blog/issues/38">来源</a>

## 根据 Performance API 获取前端性能数据

前端性能数据包含两部分，一是通过 Performance API 获得的性能数据，二是自定义的在每个页面应该上报的数据。

首先来看通过 Performance API 所获取的数据,该数据也包含了两个部分，当前页面的性能相关数据以及当前页面资源加载和异步请求的相关数据
1. Performance API 所提供的性能数据
    window.performance.timing 会返回一个对象，该对象包含了各种与页面渲染所相关的数据。本文不会具体去介绍该对象，只给出根据该对象计算相关性能数据的方法：
    ```
    let times = {};
    let t = window.performance.timing;

    //重定向时间
    times.redirectTime = t.redirectEnd - t.redirectStart;

    //dns 查询耗时
    times.dnsTime = t.domainLookupEnd - t.domainLookupStart;

    //TTFB 读取页面第一个字节的时间
    times.ttfbTime = t.responseStart - t.navigationStart;

    //DNS 缓存时间
    times.appcacheTime = t.domainLookupStart - t.fetchStart;

    //卸载页面的时间
    times.unloadTime = t.unloadEventEnd - t.unloadEventStart;

    //tcp 连接耗时
    times.tcpTime = t.connectEnd - t.connectStart;

    //request 请求耗时
    times.reqTime = t.responseEnd - t.responseStart;

    //解析 dom 树耗时
    times.analysisTime = t.domComplete - t.domInteractive;

    //白屏时间
    times.blankTime = t.domLoading - t.fetchStart;

    //domReadyTime
    times.domReadyTime = t.domContentLoadedEventEnd - t.fetchStart;
    ```

    在上面的 times 对象中就包含了性能相关的属性，根据 performance.timing 中的相关属性计算就可以得到结果。在这里我们认为 domReadyTime 就是首屏加载的时间，此外也可以自定义的方法上报首屏的时间：

    比如有些场景可以认为是 dom 增量最大的点为首屏渲染完成的时间，也有一些场景可以定义可见的 dom 在增量最大处为首屏渲染完成的时间。
