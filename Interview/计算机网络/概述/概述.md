## 计算机网络结构
<a src="https://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html
" style="text-decroation:none;">来源</a>
- 网络模型
    - 五层协议
        - 应用层 最接近用户
        - 传输层
        - 网络层
        - 链接层
        - 实体层 最接近硬件
    - 实体层 "实体层"，它就是把电脑连接起来的物理手段。它主要规定了网络的一些电气特性，作用是负责传送0和1的电信号。
        - "实体层"，它就是把电脑连接起来的物理手段。它主要规定了网络的一些电气特性，作用是负责传$0$
        和$1$的电信号。
    - 链接层
        - 定义
            - 在"实体层"的上方，确定了$0$和$1$的分组方式，负责电信号的解读方式，如多少个电信号算一组？每个信号位有何意义？
        - 以太网协议
            - 以太网规定，一组电信号构成一个数据包，叫做"帧"（Frame）。每一帧分成两个部分：标头（Head）和数据（Data）。
            - "标头"包含数据包的一些说明项，比如发送者、接受者、数据类型等等；"数据"则是数据包的具体内容。
            - "标头"的长度，固定为$18$字节。"数据"的长度，最短为$46$字节，最长为$1500$字节。因此，整个"帧"最短为$64$字节，最长为$1518$字节。如果数据很长，就必须分割成多个帧进行发送。
        - MAC地址
            - 以太网数据包的"标头"，包含了发送者和接受者的信息。那么，发送者和接受者是如何标识呢？以太网规定，连入网络的所有设备，都必须具有"网卡"接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做$MAC$地址。
            - 每块网卡出厂的时候，都有一个全世界独一无二的$MAC$地址，长度是$48$个二进制位，通常用$12$个十六进制数表示。
            -前$6$个十六进制数是厂商编号，后$6$个是该厂商的网卡流水号。有了$MAC$地址，就可以定位网卡和数据包的路径了。
        - 广播（broadcasting）
            - 网卡之间通过**ARP**协议来得知彼此的MAC地址；以太网数据包必须知道接受的方的MAC地址，然后才能发送，而发送的方式就是**广播**；
            - 如图所示， <img src="https://www.ruanyifeng.com/blogimg/asset/201205/bg2012052907.png">上图中，$1$号计算机向$2$号计算机发送一个数据包，同一个子网络的$3$号、$4$号,$5$号计算机都会收到这个包。它们读取这个包的"标头"，找到接收方的$MAC$地址，然后与自身的 MAC 地址相比较，如果两者相同，就接受这个包，做进一步处理，否则就丢弃这个包。这种发送方式就叫做"广播"（broadcasting）。

            有了数据包的定义、网卡的$MAC$地址、广播的发送方式，"链接层"就可以在多台计算机之间传送数据

    - 网络层
        - 网络层由来
            - 以太网采用广播方式发送数据包，所有成员人手一"包"，不仅效率低，而且局限在发送者所在的子网络。也就是说，如果两台计算机不在同一个子网络，广播是传不过去的。这种设计是合理的，否则互联网上每一台计算机都会收到所有包，那会引起灾难。
            - 因此，必须找到一种方法，能够区分哪些 MAC 地址属于同一个子网络，哪些不是。如果是同一个子网络，就采用广播方式发送，否则就采用"路由"方式发送。而$MAC$地址本身无法做到这一点。它只与厂商有关，与所处网络无关。
            - 这就导致了"网络层"的诞生。它的作用是引进一套新的地址，使得我们能够区分不同的计算机是否属于同一个子网络。这套地址就叫做"网络地址"，简称"网址"。
            - "网络层"出现以后，每台计算机有了两种地址，一种是 MAC 地址，另一种是网络地址。两种地址之间没有任何联系，MAC 地址是绑定在网卡上的，网络地址则是管理员分配的，它们只是随机组合在一起。网络地址帮助我们确定计算机所在的子网络，MAC 地址则将数据包送到该子网络中的目标网卡
        - $IP$协议
            - 规定网络地址的协议，叫做$IP$协议。它所定义的地址，就被称为$IP$地址。目前广泛采用的是 $IPv4$和$IPv6$
            - 互联网上的每一台计算机，都会分配到一个$IP$ 地址。这个地址分成两个部分，前一部分代表网络，后一部分代表主机。
            - $IP$协议的作用主要有两个，一个是为每一台计算机分配$IP$地址，另一个是确定哪些地址在同一个子网络。
        - 子网掩码
            - 使用$IP$地址和子网掩码进行$AND$操作，得出结果相同的地址表示在同一个子网；例，已知$IP$地址 $172.16.254.1$和$172.16.254.233$的子网掩码都是$255.255.255.0$，请问它们是否在同一个子网络？两者与子网掩码分别进行$AND$运算，结果都是$172.16.254.0$，因此它们在同一个子网络。
        - $IP$数据包
            - $IP$数据包直接放进以太网数据包的"数据"部分，因此完全不用修改以太网的规格。这就是互联网分层结构的好处：上层的变动完全不涉及下层的结构
        - $ARP$协议
            - 因为$IP#数据包是放在以太网数据包里发送的，所以我们必须同时知道两个地址，一个是对方的 MAC 地址，另一个是对方的$IP$地址。通常情况下，对方的$IP$地址是已知的（后文会解释），但是我们不知道它的$MAC$地址。所以，我们需要一种机制，能够从$IP$地址得到 $MAC$地址。

            - 第一种情况，如果两台主机不在同一个子网络，那么事实上没有办法得到对方的 MAC 地址，只能把数据包传送到两个子网络连接处的"网关"（gateway），让网关去处理。

            - 第二种情况，如果两台主机在同一个子网络，那么我们可以用$ARP$协议，得到对方的$MAC$地址。ARP 协议也是发出一个数据包（包含在以太网数据包中），其中包含它所要查询主机的$IP$地址，在对方的 MAC 地址这一栏，填的FF:FF:FF:FF:FF:FF，表示这是一个"广播"地址。它所在子网络的每一台主机，都会收到这个数据包，从中取出$IP$地址，与自身的$IP$地址进行比较。如果两者相同，都做出回复，向对方报告自己的 MAC 地址，否则就丢弃这个包。

            - 总之，有了 ARP 协议之后，我们就可以得到同一个子网络内的主机 MAC 地址，可以把数据包发送到任意一台主机之上了。

    - 传输层
        - 有了 MAC 地址和 IP 地址，我们已经可以在互联网上任意两台主机上建立通信。接下来的问题是，同一台主机上有许多程序都需要用到网络，比如，你一边浏览网页，一边与朋友在线聊天。当一个数据包从互联网上发来的时候，你怎么知道，它是表示网页的内容，还是表示在线聊天的内容？
        - "传输层"的功能，就是建立"端口到端口"的通信。相比之下，"网络层"的功能是建立"主机到主机"的通信。只要确定主机和端口，我们就能实现程序之间的交流。因此，Unix 系统就把主机+端口，叫做"套接字"（socket）
    - 应用层
        - 应用程序收到"传输层"的数据，接下来就要进行解读。"应用层"的作用，就是规定应用程序的数据格式
        - 这是最高的一层，直接面对用户。它的数据就放在 $TCP$数据包的"数据"部分。
    - 静态$IP$地址
        - 由于它们是给定的，计算机每次开机，都会分到同样的 IP 地址，所以这种情况被称作"静态 IP 地址上网"。
        - 本机的$IP$地址
        - 子网掩码
        - 网关的$IP$地址
        - $DNS$的$IP$地址
    - 动态$IP$地址
        - 所谓"动态 IP 地址"，指计算机开机后，会自动分配到一个 IP 地址，不用人为设定。它使用的协议叫$DHCP$协议
        

