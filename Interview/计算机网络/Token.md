# 什么是Token
Token 是服务端生成的一串字符串，以作客户端进行请求的一个令牌，当第一次登录后，服务器生成一个 Token 便将此 Token 返回给客户端，以后客户端只需带上这个 Token 前来请求数据即可，无需再次带上用户名和密码

# Token使用举例
客户端使用用户名密码登录。
- 服务端收到请求，去验证用户名与密码。验证成功后，服务端会签发一个 Token，把这个 Token 发送给客户端。
- 客户端将收到的 Token 存储起来。（cookie 或者 localStorage）
- 客户端每次需要登录验证的请求都需要带着 Token 发送给服务器端。
- 服务器端收到请求后先验证 Token，如果成功，返回数据

# 有效期设置
Refresh Token，它可以避免频繁的读写操作。这种方案中，服务端不需要刷新 Token 的过期时间，一旦 Token 过期，就反馈给前端，前端使用 Refresh Token 申请一个全新 Token 继续使用。这种方案中，服务端只需要在客户端请求更新 Token 的时候对 Refresh Token 的有效性进行一次检查

# Token解决的问题
- Token 完全由应用管理，所以它可以避开同源策略
- Token 可以避免 CSRF 攻击
- Token 可以是无状态的，可以在多个服务间共享

# 无状态Token
1. 服务端能确认是自己签发的 Token，而且其信息未被改动过，那就可以认为 Token 有效
2. 签发和验证都是服务器=》 对称加密算法=》 只需验证 不需要解密 =》 散列算法 HMAC

## 在使用无状态 Token 的时候，有两点需要注意：
- Refresh Token 有效时间较长，所以它应该在服务器端有状态，以增强安全性，确保用户注销时可控
- 应该考虑使用二次认证来增强敏感操作的安全性

## 分离认证服务
前端拿到一个有效的 Token，它就可以在任何同一体系的服务上认证通过——只要它们使用同样的密钥和算法来认证 Token 的有效性

当**业务服务器**已经不受信任的时候，多个业务服务器之间使用相同的 Token 对用户来说是不安全的。因为任何一个服务器拿到 Token 都可以仿冒用户去另一个服务器处理业务……悲剧随时可能发生。

为了防止这种情况发生，就需要在认证服务器产生 Token 的时候，把使用该 Token 的业务服务器的信息记录在 Token 中，这样当另一个业务服务器拿到这个 Token 的时候，发现它并不是自己应该验证的 Token，就可以直接拒绝。


# 解决Token劫持
- 在存储的时候把 token 进行对称加密存储，用时解开。
- 将请求 URL、时间戳、token 三者进行合并加盐签名，服务端校验有效性。
- HTTPS 对 URL 进行判断。
